(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{357:function(t,s,n){"use strict";n.r(s);var e=n(1),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"开始编写你的应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开始编写你的应用"}}),t._v(" 开始编写你的应用")]),t._v(" "),n("p",[t._v("首先创建一个新的文件"),n("code",[t._v("./app.go")]),t._v("。这个文件是确定性状态机的核心。在"),n("code",[t._v("app.go")]),t._v("中，你定义了应用程序在接收交易时执行的操作。但首先，它要能够以正确的顺序接收交易。这是 "),n("a",{attrs:{href:"https://github.com/tendermint/tendermint",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tendermint共识引擎"),n("OutboundLink")],1),t._v("的职责。")]),t._v(" "),n("p",[t._v("引入必要的依赖：")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" app\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encoding/json"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"os"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/tendermint/tendermint/libs/log"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/codec"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/auth"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/auth/genaccounts"')]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/bank"')]),t._v("\n\tdistr "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/distribution"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/params"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/x/staking"')]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/sdk-tutorials/nameservice/x/nameservice"')]),t._v("\n\n\tbam "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/baseapp"')]),t._v("\n\tsdk "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/cosmos/cosmos-sdk/types"')]),t._v("\n\tabci "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/tendermint/tendermint/abci/types"')]),t._v("\n\tcmn "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/tendermint/tendermint/libs/common"')]),t._v("\n\tdbm "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/tendermint/tm-db"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("下面是各引入模块和包的文档：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://godoc.org/github.com/tendermint/tendermint/libs/log",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("log")]),n("OutboundLink")],1),t._v(": Tendermint 的日志")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://godoc.org/github.com/cosmos/cosmos-sdk/x/auth",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("auth")]),n("OutboundLink")],1),t._v(": Cosmos SDK 的"),n("code",[t._v("auth")]),t._v("模块")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://godoc.org/github.com/tendermint/tm-db",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("dbm")]),n("OutboundLink")],1),t._v(": Tendermint 的数据库代码")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://godoc.org/github.com/cosmos/cosmos-sdk/baseapp",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("baseapp")]),n("OutboundLink")],1),t._v(": 如下")])]),t._v(" "),n("p",[t._v("这里有几个包是"),n("code",[t._v("tendermint")]),t._v("包。Tendermint 通过名为 "),n("a",{attrs:{href:"https://github.com/tendermint/tendermint/tree/master/abci",target:"_blank",rel:"noopener noreferrer"}},[t._v("ABCI"),n("OutboundLink")],1),t._v(" 的接口将交易从网络传递给应用程序。如果你要查看正在构建的区块链节点的架构，如下所示：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("+---------------------+\n|                     |\n|     Application     |\n|                     |\n+--------+---+--------+\n         ^   |\n         |   | ABCI\n         |   v\n+--------+---+--------+\n|                     |\n|                     |\n|     Tendermint      |\n|                     |\n|                     |\n+---------------------+\n")])])]),n("p",[t._v("幸运的是，你不必实现ABCI接口。Cosmos SDK以"),n("a",{attrs:{href:"https://godoc.org/github.com/cosmos/cosmos-sdk/baseapp",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("baseapp")]),n("OutboundLink")],1),t._v("的形式提供了它的实现样板。")]),t._v(" "),n("p",[n("code",[t._v("baseapp")]),t._v("做了以下几点：")]),t._v(" "),n("ul",[n("li",[t._v("解码从 Tendermint 共识引擎接收到的交易。")]),t._v(" "),n("li",[t._v("从交易中提取 messages 并做基本的合理性校验。")]),t._v(" "),n("li",[t._v("将这些 message 路由到合适的模块使其被正确处理。注意"),n("code",[t._v("baseapp")]),t._v("并不了解你想要使用的具体模块。你要做的就是在"),n("code",[t._v("app.go")]),t._v("中声明这些模块，在接下来的教程中将会看到这些工作。"),n("code",[t._v("baseapp")]),t._v("仅实现了适用于任意模块的核心路由逻辑。")]),t._v(" "),n("li",[t._v("如果 ABCI 消息是"),n("a",{attrs:{href:"https://tendermint.com/docs/spec/abci/abci.html#delivertx",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("DeliverTx")]),n("OutboundLink")],1),t._v("（"),n("a",{attrs:{href:"https://tendermint.com/docs/spec/abci/abci.html#checktx",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("CheckTx")]),n("OutboundLink")],1),t._v("）的话就Commit。")]),t._v(" "),n("li",[t._v("帮助设置"),n("a",{attrs:{href:"https://tendermint.com/docs/spec/abci/abci.html#beginblock",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("BeginBlock")]),n("OutboundLink")],1),t._v("和"),n("a",{attrs:{href:"https://tendermint.com/docs/spec/abci/abci.html#endblock",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("EndBlock")]),n("OutboundLink")],1),t._v(",这两种消息让你能定义在每个区块开始和结束时执行的逻辑。实际上，每个模块实现了各自的"),n("code",[t._v("BeginBlock")]),t._v("和"),n("code",[t._v("EndBlock")]),t._v("子逻辑，app的职责是它们都聚合起来。（"),n("em",[t._v("注意：你不会在你的应用程序中使用这些消息")]),t._v("）")]),t._v(" "),n("li",[t._v("帮助初始化你的 state。")]),t._v(" "),n("li",[t._v("帮助设置 queries。")])]),t._v(" "),n("p",[t._v("现在你需要为应用程序创建一个新的自定义类型"),n("code",[t._v("nameServiceApp")]),t._v("。这个类型将嵌入"),n("code",[t._v("baseapp")]),t._v("（在Go中的嵌入类似于其他语言中的继承），这意味着它可以访问"),n("code",[t._v("baseapp")]),t._v("的所有方法。")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" appName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nameservice"')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// default home directories for the application CLI")]),t._v("\n\tDefaultCLIHome "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExpandEnv")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$HOME/.nscli"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DefaultNodeHome sets the folder where the applcation data and configuration will be stored")]),t._v("\n\tDefaultNodeHome "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ExpandEnv")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$HOME/.nsd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// NewBasicManager is in charge of setting up basic module elemnets")]),t._v("\n\tModuleBasics "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewBasicManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// account permissions")]),t._v("\n\tmaccPerms "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" nameServiceApp "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("bam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BaseApp\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("为你的应用添加一个简单的构造函数:")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewNameServiceApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("logger log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db dbm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("nameServiceApp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// First define the top level codec that will be shared by the different modules. Note: Codec will be explained later")]),t._v("\n    cdc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("MakeCodec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// BaseApp handles interactions with Tendermint through the ABCI protocol")]),t._v("\n    bApp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" bam"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewBaseApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DefaultTxDecoder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cdc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("nameServiceApp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        BaseApp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bApp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cdc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("     cdc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" app\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("很好！现在你有了应用程序的骨架；但是，仍然缺少具体功能。")]),t._v(" "),n("p",[n("code",[t._v("baseapp")]),t._v("不了解你要在应用程序中使用的路由或用户交互。应用程序的主要作用是定义这些路由。另一个作用是定义初始状态。这两件事都要求你向应用程序添加模块。")]),t._v(" "),n("p",[t._v("正如你在"),n("router-link",{attrs:{to:"/nameservice/tutorial/cn/01-app-design.html"}},[t._v("应用设计")]),t._v("章节中看到的，你的nameservice需要一组模块："),n("code",[t._v("auth")]),t._v("，"),n("code",[t._v("bank")]),t._v("，"),n("code",[t._v("staking")]),t._v("，"),n("code",[t._v("distribution")]),t._v("，"),n("code",[t._v("slashing")]),t._v("和"),n("code",[t._v("nameservice")]),t._v("。前两个已经存在了，但最后一个还没有！"),n("code",[t._v("nameservice")]),t._v("模块将定义你的状态机的大部分内容。下一步是构建它。")],1),t._v(" "),n("h3",{attrs:{id:"为了完成应用程序，你需要引入一些模块。-继续开始构建你的域名服务模块-。-稍后会回到-app-go"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为了完成应用程序，你需要引入一些模块。-继续开始构建你的域名服务模块-。-稍后会回到-app-go"}}),t._v(" 为了完成应用程序，你需要引入一些模块。 继续"),n("router-link",{attrs:{to:"/nameservice/tutorial/cn/03-types.html"}},[t._v("开始构建你的域名服务模块")]),t._v(" 。 稍后会回到 app.go.")],1)])}),[],!1,null,null,null);s.default=a.exports}}]);